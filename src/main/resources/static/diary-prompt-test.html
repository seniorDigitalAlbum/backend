<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ê¸° ìƒì„± í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .test-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .test-area {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #667eea;
        }
        
        .output-section {
            background: #f0f8ff;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #4caf50;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
            box-sizing: border-box;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin: 10px 0;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .output-area {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Malgun Gothic', sans-serif;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            line-height: 1.6;
        }
        
        .success {
            border-color: #4caf50;
            background: #f1f8e9;
        }
        
        .error {
            border-color: #f44336;
            background: #ffebee;
            color: #c62828;
        }
        
        .loading {
            border-color: #ff9800;
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .preset-btn {
            background: #e3f2fd;
            color: #1976d2;
            border: 2px solid #1976d2;
            padding: 10px;
            font-size: 14px;
            margin: 0;
        }
        
        .preset-btn:hover {
            background: #1976d2;
            color: white;
        }
        
        .stats {
            background: #e8f5e8;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .stats h4 {
            margin: 0 0 10px 0;
            color: #2e7d32;
        }
        
        .history {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .history-item {
            background: white;
            border-radius: 5px;
            padding: 10px;
            margin: 5px 0;
            border-left: 3px solid #667eea;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .history-item:hover {
            transform: translateX(5px);
        }
        
        .history-item small {
            color: #666;
        }
        
        .json-input {
            min-height: 200px;
            font-size: 12px;
        }
        
        .diary-output {
            font-size: 16px;
            line-height: 1.8;
            background: #fffef7;
            border: 2px solid #f0e68c;
            padding: 25px;
            border-radius: 10px;
        }
        
        .prompt-view {
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 15px;
        }
        
        .tab {
            background: #e0e0e0;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ ì¼ê¸° ìƒì„± í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸</h1>
        <p style="text-align: center; color: #666; font-size: 18px;">
            Summary JSONê³¼ DiaryPlan JSONì„ ì…ë ¥í•˜ì—¬ ì¼ê¸° ìƒì„± í”„ë¡¬í”„íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”
        </p>

        <div class="test-area">
            <!-- ì…ë ¥ ì„¹ì…˜ -->
            <div class="input-section">
                <h2>ğŸ“‹ í…ŒìŠ¤íŠ¸ ì…ë ¥</h2>
                
                <!-- í”„ë¦¬ì…‹ ë²„íŠ¼ë“¤ -->
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="loadPreset('childhood')">ğŸ‘¶ ì–´ë¦°ì‹œì ˆ ì¶”ì–µ</button>
                    <button class="preset-btn" onclick="loadPreset('school')">ğŸ« í•™êµ ì‹œì ˆ</button>
                    <button class="preset-btn" onclick="loadPreset('family')">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ì´ì•¼ê¸°</button>
                    <button class="preset-btn" onclick="loadPreset('happy')">ğŸ˜Š í–‰ë³µí•œ ê¸°ì–µ</button>
                    <button class="preset-btn" onclick="loadPreset('sad')">ğŸ˜¢ ìŠ¬í”ˆ ê¸°ì–µ</button>
                    <button class="preset-btn" onclick="loadPreset('growth')">ğŸŒ± ì„±ì¥ ì´ì•¼ê¸°</button>
                </div>
                
                <div class="input-group">
                    <label for="summaryJson">Summary JSON:</label>
                    <textarea id="summaryJson" class="json-input" placeholder="ìš”ì•½ JSONì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>
                
                <div class="input-group">
                    <label for="diaryPlanJson">DiaryPlan JSON:</label>
                    <textarea id="diaryPlanJson" class="json-input" placeholder="DiaryPlan JSONì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>
                
                <button onclick="testDiaryPrompt()" id="testBtn">ğŸ“ ì¼ê¸° ìƒì„± í…ŒìŠ¤íŠ¸</button>
                <button onclick="clearInputs()" id="clearBtn" style="background: #757575;">ğŸ—‘ï¸ ì…ë ¥ ì´ˆê¸°í™”</button>
            </div>

            <!-- ì¶œë ¥ ì„¹ì…˜ -->
            <div class="output-section">
                <h2>ğŸ“– ì¼ê¸° ìƒì„± ê²°ê³¼</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="showTab('diary')">ğŸ“ ìƒì„±ëœ ì¼ê¸°</button>
                    <button class="tab" onclick="showTab('prompt')">ğŸ”§ í”„ë¡¬í”„íŠ¸</button>
                </div>
                
                <div id="diary-tab" class="tab-content active">
                    <div class="stats" id="stats" style="display: none;">
                        <h4>ğŸ“Š ìƒì„± í†µê³„</h4>
                        <div id="statsContent"></div>
                    </div>
                    
                    <div class="output-area diary-output" id="diaryOutput">
                        ì—¬ê¸°ì— ìƒì„±ëœ ì¼ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤...
                    </div>
                    
                    <div class="input-group" style="margin-top: 20px;">
                        <label>ì¼ê¸° í‰ê°€:</label>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="rateDiary('excellent')" style="background: #4caf50; padding: 8px 16px; font-size: 14px;">ğŸŒŸ í›Œë¥­í•¨</button>
                            <button onclick="rateDiary('good')" style="background: #2196f3; padding: 8px 16px; font-size: 14px;">ğŸ‘ ì¢‹ìŒ</button>
                            <button onclick="rateDiary('fair')" style="background: #ff9800; padding: 8px 16px; font-size: 14px;">âš–ï¸ ë³´í†µ</button>
                            <button onclick="rateDiary('poor')" style="background: #f44336; padding: 8px 16px; font-size: 14px;">ğŸ‘ ë‚˜ì¨</button>
                            <button onclick="rateDiary('save')" style="background: #9c27b0; padding: 8px 16px; font-size: 14px;">ğŸ’¾ ì €ì¥</button>
                        </div>
                    </div>
                </div>
                
                <div id="prompt-tab" class="tab-content">
                    <div class="prompt-view" id="promptView">
                        í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                    </div>
                </div>
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ íˆìŠ¤í† ë¦¬ -->
        <div class="history">
            <h3>ğŸ“š í…ŒìŠ¤íŠ¸ íˆìŠ¤í† ë¦¬</h3>
            <div id="historyList">
                <p style="color: #666; text-align: center;">ì•„ì§ í…ŒìŠ¤íŠ¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';
        let testHistory = [];
        let currentResponse = null;

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ê³¼ ì½˜í…ì¸  ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ê³¼ ì½˜í…ì¸  í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // í”„ë¦¬ì…‹ ë°ì´í„° ë¡œë“œ
        function loadPreset(type) {
            const presets = {
                childhood: {
                    summaryJson: `{
  "meta": {"date": "2025-09-16", "locale": "ko-KR"},
  "situation": "ì–´ë¦° ì‹œì ˆ ë™ë„¤ì—ì„œ ì¹œêµ¬ë“¤ê³¼ ë†€ë˜ ì¶”ì–µì„ íšŒìƒí•˜ë©° ëŒ€í™”í–ˆìŠµë‹ˆë‹¤.",
  "events": [
    "ë™ë„¤ ê³¨ëª©ì—ì„œ ìˆ¨ë°”ê¼­ì§ˆì„ í•˜ë©° ë†€ì•˜ë˜ ê¸°ì–µ",
    "ì—„ë§ˆê°€ ë¶€ë¥´ëŠ” ì†Œë¦¬ì— ì§‘ìœ¼ë¡œ ë›°ì–´ê°€ë˜ ëª¨ìŠµ",
    "ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ë¼ë©´ì„ ë“ì—¬ ë¨¹ë˜ ì¶”ì–µ"
  ],
  "anchors": {
    "people": ["ë™ë„¤ ì¹œêµ¬ë“¤", "ì—„ë§ˆ"],
    "place": ["ë™ë„¤ ê³¨ëª©", "ìš°ë¦¬ ì§‘"],
    "era": "ì´ˆë“±í•™êµ ì‹œì ˆ",
    "objects": ["ë¼ë©´", "ìˆ¨ì„ ê³³"]
  },
  "highlights": {
    "best_moment": "ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ì›ƒìœ¼ë©° ë†€ë˜ ìˆœê°„",
    "hard_moment": "ì§‘ì— ë“¤ì–´ê°€ê¸° ì‹«ì–´ì„œ ìˆ¨ì–´ìˆë˜ ìˆœê°„",
    "insight": "ì–´ë¦° ì‹œì ˆì˜ ìˆœìˆ˜í•œ ì¦ê±°ì›€ì´ ê°€ì¥ ì†Œì¤‘í•œ ë³´ë¬¼ì´ì—ˆë‹¤"
  },
  "quotes": ["ê·¸ë•ŒëŠ” ì •ë§ ì‹œê°„ ê°€ëŠ” ì¤„ ëª°ëì–´ìš”"]
}`,
                    diaryPlanJson: `{
  "flowPattern": "U-shape",
  "opening": {"dominant": "ê·¸ë¦¬ì›€", "valenceMean": -0.3},
  "turningPoint": {"turn": 4, "dominant": "ê¸°ì¨"},
  "closing": {"dominant": "í–‰ë³µ", "valenceMean": 0.8},
  "styleHints": {
    "toneStart": "ì°¨ë¶„í•œ íšŒìƒ",
    "toneMid": "ì ì  ë°ì•„ì§€ëŠ”",
    "toneEnd": "ë”°ëœ»í•œ ê°ì‚¬"
  }
}`
                },
                school: {
                    summaryJson: `{
  "meta": {"date": "2025-09-16", "locale": "ko-KR"},
  "situation": "ì¤‘í•™êµ ì‹œì ˆ ì²« ì‹œí—˜ì„ ë³´ë˜ ê¸´ì¥ë˜ê³  ë–¨ë ¸ë˜ ê²½í—˜ì„ ë‚˜ëˆ„ì—ˆìŠµë‹ˆë‹¤.",
  "events": [
    "ì²« ì¤‘ê°„ê³ ì‚¬ë¥¼ ì•ë‘ê³  ë°¤ëŠ¦ê²Œ ê³µë¶€í–ˆë˜ ê¸°ì–µ",
    "ì‹œí—˜ ë‹¹ì¼ ì•„ì¹¨ ê¸´ì¥í•´ì„œ ë°¥ì„ ëª» ë¨¹ì—ˆë˜ ì¼",
    "ê²°ê³¼ë¥¼ ë°›ê³  ìƒê°ë³´ë‹¤ ì˜ ë‚˜ì™€ì„œ ê¸°ë»¤ë˜ ìˆœê°„"
  ],
  "anchors": {
    "people": ["ë‹´ì„ì„ ìƒë‹˜", "ì—„ë§ˆ", "ì¹œêµ¬ë“¤"],
    "place": ["êµì‹¤", "ì§‘ ì±…ìƒ"],
    "era": "ì¤‘í•™êµ 1í•™ë…„",
    "objects": ["ì‹œí—˜ì§€", "êµê³¼ì„œ", "ì—°í•„"]
  },
  "highlights": {
    "best_moment": "ê²°ê³¼ë¥¼ ë³´ê³  ì•ˆë„ì˜ í•œìˆ¨ì„ ì‰¬ë˜ ìˆœê°„",
    "hard_moment": "ì‹œí—˜ ì „ë‚  ë°¤ ë„ˆë¬´ ê¸´ì¥í•´ì„œ ì ì´ ì•ˆ ì™”ë˜ ì‹œê°„",
    "insight": "ë…¸ë ¥í•œ ë§Œí¼ ê²°ê³¼ê°€ ë”°ë¼ì˜¨ë‹¤ëŠ” ê²ƒì„ ì²˜ìŒ ê¹¨ë‹¬ì•˜ë‹¤"
  },
  "quotes": ["ê·¸ë•Œ ì²˜ìŒìœ¼ë¡œ ê³µë¶€ì˜ ë³´ëŒì„ ëŠê¼ˆì–´ìš”"]
}`,
                    diaryPlanJson: `{
  "flowPattern": "ìƒìŠ¹í˜•",
  "opening": {"dominant": "ë¶ˆì•ˆ", "valenceMean": -0.6},
  "turningPoint": {"turn": 5, "dominant": "ì•ˆë„"},
  "closing": {"dominant": "ë¿Œë“¯í•¨", "valenceMean": 0.7},
  "styleHints": {
    "toneStart": "ê¸´ì¥ê° ìˆëŠ”",
    "toneMid": "ì ì°¨ ì•ˆì •ë˜ëŠ”",
    "toneEnd": "ë¿Œë“¯í•˜ê³  ê°ì‚¬í•œ"
  }
}`
                },
                family: {
                    summaryJson: `{
  "meta": {"date": "2025-09-16", "locale": "ko-KR"},
  "situation": "í• ë¨¸ë‹ˆì™€ í•¨ê»˜ ê¹€ì¹˜ë¥¼ ë‹´ê·¸ë˜ ë”°ëœ»í•œ ê°€ì¡±ì˜ ì‹œê°„ì„ íšŒìƒí–ˆìŠµë‹ˆë‹¤.",
  "events": [
    "í• ë¨¸ë‹ˆ ì†ì„ ì¡ê³  ê¹€ì¹˜ ë‹´ê·¸ëŠ” ë²•ì„ ë°°ì› ë˜ ê¸°ì–µ",
    "ë°°ì¶”ë¥¼ ì ˆì´ëŠ” ë™ì•ˆ í• ë¨¸ë‹ˆ ì˜›ë‚ ì´ì•¼ê¸°ë¥¼ ë“¤ì—ˆë˜ ì‹œê°„",
    "ì™„ì„±ëœ ê¹€ì¹˜ë¥¼ ë§›ë³´ë©° í• ë¨¸ë‹ˆê»˜ ì¹­ì°¬ë°›ì•˜ë˜ ìˆœê°„"
  ],
  "anchors": {
    "people": ["í• ë¨¸ë‹ˆ", "ì—„ë§ˆ"],
    "place": ["í• ë¨¸ë‹ˆ ì§‘ ë¶€ì—Œ", "ë§ˆë‹¹"],
    "era": "ê³ ë“±í•™êµ ì‹œì ˆ",
    "objects": ["ë°°ì¶”", "ê³ ì¶§ê°€ë£¨", "ê¹€ì¹˜í†µ"]
  },
  "highlights": {
    "best_moment": "í• ë¨¸ë‹ˆê°€ ë‚´ê°€ ë‹´ê·¼ ê¹€ì¹˜ê°€ ë§›ìˆë‹¤ê³  í•˜ì…¨ë˜ ìˆœê°„",
    "hard_moment": "ì²˜ìŒì´ë¼ ì„œíˆ´ëŸ¬ì„œ í• ë¨¸ë‹ˆê»˜ ë¯¸ì•ˆí–ˆë˜ ë§ˆìŒ",
    "insight": "ê°€ì¡±ì˜ ì†ë§›ì€ ì‚¬ë‘ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ë‹¤"
  },
  "quotes": ["í• ë¨¸ë‹ˆ ì†ë§›ì„ ë”°ë¼í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ ë§ˆìŒë§Œì€ ë‹´ì„ ìˆ˜ ìˆì„ ê²ƒ ê°™ì•„ìš”"]
}`
                },
                happy: {
                    summaryJson: `{
  "meta": {"date": "2025-09-16", "locale": "ko-KR"},
  "situation": "ëŒ€í•™ ì¡¸ì—…ì‹ ë‚ ì˜ ê¸°ì˜ê³  ë¿Œë“¯í–ˆë˜ ìˆœê°„ë“¤ì„ ë‚˜ëˆ„ì—ˆìŠµë‹ˆë‹¤.",
  "events": [
    "ì¡¸ì—…ê°€ìš´ì„ ì…ê³  ê°€ì¡±ë“¤ê³¼ ì‚¬ì§„ì„ ì°ì—ˆë˜ ìˆœê°„",
    "ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ì¡¸ì—…ì‹ í›„ ì¶•í•˜ íŒŒí‹°ë¥¼ í–ˆë˜ ê¸°ì–µ",
    "ë¶€ëª¨ë‹˜ì´ ëˆˆë¬¼ì„ í˜ë¦¬ë©° ì¶•í•˜í•´ì£¼ì…¨ë˜ ê°ë™ì ì¸ ìˆœê°„"
  ],
  "anchors": {
    "people": ["ë¶€ëª¨ë‹˜", "ëŒ€í•™ ì¹œêµ¬ë“¤", "êµìˆ˜ë‹˜"],
    "place": ["ëŒ€í•™êµ ê°•ë‹¹", "ì¡¸ì—…ì‹ì¥"],
    "era": "20ëŒ€ ì´ˆë°˜",
    "objects": ["ì¡¸ì—…ì¥", "ì¡¸ì—…ê°€ìš´", "ê½ƒë‹¤ë°œ"]
  },
  "highlights": {
    "best_moment": "ë¶€ëª¨ë‹˜ì˜ ìë‘ìŠ¤ëŸ¬ìš´ ëˆˆë¹›ì„ ë³´ì•˜ë˜ ìˆœê°„",
    "hard_moment": "ì¹œêµ¬ë“¤ê³¼ í—¤ì–´ì ¸ì•¼ í•œë‹¤ëŠ” ì•„ì‰¬ì›€",
    "insight": "ë§ì€ ì‚¬ëŒë“¤ì˜ ì‚¬ë‘ê³¼ ì‘ì›ì´ ìˆì—ˆê¸°ì— ê°€ëŠ¥í–ˆë˜ ì„±ì·¨ì˜€ë‹¤"
  },
  "quotes": ["ì´ì œ ì •ë§ ì–´ë¥¸ì´ ëœ ê¸°ë¶„ì´ì—ìš”"]
}`
                },
                sad: {
                    summaryJson: `{
  "meta": {"date": "2025-09-16", "locale": "ko-KR"},
  "situation": "ë°˜ë ¤ê²¬ê³¼ì˜ ë§ˆì§€ë§‰ ìˆœê°„ë“¤ì„ íšŒìƒí•˜ë©° ìŠ¬í””ê³¼ ê·¸ë¦¬ì›€ì„ ë‚˜ëˆ„ì—ˆìŠµë‹ˆë‹¤.",
  "events": [
    "ì•„í”ˆ ê°•ì•„ì§€ë¥¼ ë³‘ì›ì— ë°ë ¤ê°”ë˜ ë§ˆì§€ë§‰ ë‚ ",
    "ì§‘ì—ì„œ ì¡°ìš©íˆ ê°•ì•„ì§€ë¥¼ ì•ˆê³  ìˆì—ˆë˜ ì‹œê°„",
    "ë¬´ì§€ê°œ ë‹¤ë¦¬ë¥¼ ê±´ë„œë‹¤ëŠ” ì†Œì‹ì„ ë“¤ì—ˆë˜ ìˆœê°„"
  ],
  "anchors": {
    "people": ["ìˆ˜ì˜ì‚¬ ì„ ìƒë‹˜", "ê°€ì¡±ë“¤"],
    "place": ["ë™ë¬¼ë³‘ì›", "ì§‘ ê±°ì‹¤"],
    "era": "ì„±ì¸ì´ ë˜ì–´ì„œ",
    "objects": ["ê°•ì•„ì§€ ëª©ì¤„", "ì¢‹ì•„í•˜ë˜ ì¥ë‚œê°"]
  },
  "highlights": {
    "best_moment": "ë§ˆì§€ë§‰ê¹Œì§€ ê¼¬ë¦¬ë¥¼ í”ë“¤ì–´ì£¼ì—ˆë˜ ëª¨ìŠµ",
    "hard_moment": "ì‘ë³„ ì¸ì‚¬ë¥¼ í•´ì•¼ í–ˆë˜ ê·¸ ìˆœê°„",
    "insight": "ì§§ì€ ë§Œë‚¨ì´ì—ˆì§€ë§Œ ì„œë¡œì—ê²Œ í° ì˜ë¯¸ì˜€ë˜ ì†Œì¤‘í•œ ì‹œê°„ì´ì—ˆë‹¤"
  },
  "quotes": ["ì •ë§ ê³ ë§ˆì› ì–´, ë§ì´ ì‚¬ë‘í–ˆì–´"]
}`
                },
                growth: {
                    summaryJson: `{
  "meta": {"date": "2025-09-16", "locale": "ko-KR"},
  "situation": "ì²« ì§ì¥ì—ì„œì˜ ì‹¤ìˆ˜ì™€ ê·¸ë¡œ ì¸í•œ ì„±ì¥ ê²½í—˜ì„ ë‚˜ëˆ„ì—ˆìŠµë‹ˆë‹¤.",
  "events": [
    "ì¤‘ìš”í•œ í”„ë ˆì  í…Œì´ì…˜ì—ì„œ ì‹¤ìˆ˜ë¥¼ í–ˆë˜ ìˆœê°„",
    "ìƒì‚¬ì—ê²Œ í˜¼ë‚˜ê³  ìì±…í•˜ë©° ì§‘ì— ëŒì•„ì™”ë˜ ë‚ ",
    "ë‹¤ì‹œ ì¼ì–´ì„œì„œ ë” ì—´ì‹¬íˆ ì¤€ë¹„í–ˆë˜ ë‹¤ìŒ ê¸°íšŒ"
  ],
  "anchors": {
    "people": ["ìƒì‚¬", "ë™ë£Œë“¤", "ê°€ì¡±"],
    "place": ["íšŒì‚¬ íšŒì˜ì‹¤", "ì§‘"],
    "era": "ì‚¬íšŒ ì´ˆë…„ìƒ ì‹œì ˆ",
    "objects": ["í”„ë ˆì  í…Œì´ì…˜ ìë£Œ", "ë…¸íŠ¸ë¶"]
  },
  "highlights": {
    "best_moment": "ë‘ ë²ˆì§¸ ê¸°íšŒì—ì„œ ì„±ê³µì ìœ¼ë¡œ í•´ëƒˆë˜ ìˆœê°„",
    "hard_moment": "ëª¨ë“  ê²ƒì´ ë¬´ë„ˆì§„ ê²ƒ ê°™ì•˜ë˜ ê·¸ ì²« ì‹¤ìˆ˜ì˜ ìˆœê°„",
    "insight": "ì‹¤íŒ¨ëŠ” ëì´ ì•„ë‹ˆë¼ ë” ë‚˜ì€ ì‹œì‘ì„ ìœ„í•œ ë°œíŒì´ì—ˆë‹¤"
  },
  "quotes": ["ê·¸ë•Œ ê·¸ ì‹¤ìˆ˜ê°€ ì§€ê¸ˆì˜ ì €ë¥¼ ë§Œë“¤ì–´ì¤€ ê²ƒ ê°™ì•„ìš”"]
}`
                }
            };

            const preset = presets[type];
            if (preset) {
                document.getElementById('summaryJson').value = preset.summaryJson;
                document.getElementById('diaryPlanJson').value = preset.diaryPlanJson;
            }
        }

        // ì…ë ¥ ì´ˆê¸°í™”
        function clearInputs() {
            document.getElementById('summaryJson').value = '';
            document.getElementById('diaryPlanJson').value = '';
            document.getElementById('diaryOutput').textContent = 'ì—¬ê¸°ì— ìƒì„±ëœ ì¼ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤...';
            document.getElementById('diaryOutput').className = 'output-area diary-output';
            document.getElementById('promptView').textContent = 'í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...';
            document.getElementById('stats').style.display = 'none';
        }

        // ì¼ê¸° ìƒì„± í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸
        async function testDiaryPrompt() {
            const summaryJson = document.getElementById('summaryJson').value.trim();
            const diaryPlanJson = document.getElementById('diaryPlanJson').value.trim();

            if (!summaryJson || !diaryPlanJson) {
                alert('Summary JSONê³¼ DiaryPlan JSONì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const testBtn = document.getElementById('testBtn');
            const diaryOutput = document.getElementById('diaryOutput');
            const promptView = document.getElementById('promptView');
            
            testBtn.disabled = true;
            diaryOutput.className = 'output-area diary-output loading';
            diaryOutput.textContent = 'ğŸ“ ì¼ê¸°ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...\nì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';

            const startTime = Date.now();

            try {
                const response = await fetch(`${API_BASE_URL}/gpt/diary-prompt-test`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        summaryJson: summaryJson,
                        diaryPlanJson: diaryPlanJson
                    })
                });

                const endTime = Date.now();
                const responseTime = endTime - startTime;

                if (!response.ok) {
                    throw new Error(`API ì˜¤ë¥˜ (${response.status}): ${response.statusText}`);
                }

                const result = await response.json();
                currentResponse = result;

                const diary = result.diary || 'ì¼ê¸°ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';

                // ì„±ê³µ ì¶œë ¥
                diaryOutput.className = 'output-area diary-output success';
                diaryOutput.textContent = diary;

                // í”„ë¡¬í”„íŠ¸ í‘œì‹œ
                promptView.textContent = result.fullPrompt || 'í”„ë¡¬í”„íŠ¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';

                // í†µê³„ í‘œì‹œ
                showStats(responseTime, result);

                // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
                addToHistory({
                    timestamp: new Date(),
                    summaryJson: summaryJson,
                    diaryPlanJson: diaryPlanJson,
                    diary: diary,
                    responseTime: responseTime
                });

            } catch (error) {
                const endTime = Date.now();
                const responseTime = endTime - startTime;

                diaryOutput.className = 'output-area diary-output error';
                diaryOutput.textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}\n\nì‘ë‹µ ì‹œê°„: ${responseTime}ms`;

                console.error('ì¼ê¸° ìƒì„± í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
            } finally {
                testBtn.disabled = false;
            }
        }

        // í†µê³„ í‘œì‹œ
        function showStats(responseTime, result) {
            const stats = document.getElementById('stats');
            const statsContent = document.getElementById('statsContent');
            
            const diary = result.diary || '';
            const diaryLength = diary.length;
            const paragraphs = diary.split('\n\n').length;
            const sentences = diary.split(/[.!?]/).filter(s => s.trim().length > 0).length;
            
            statsContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <div><strong>ì‘ë‹µ ì‹œê°„:</strong> ${responseTime}ms</div>
                    <div><strong>ì¼ê¸° ê¸¸ì´:</strong> ${diaryLength}ì</div>
                    <div><strong>ë‹¨ë½ ìˆ˜:</strong> ${paragraphs}ê°œ</div>
                    <div><strong>ë¬¸ì¥ ìˆ˜:</strong> ${sentences}ê°œ</div>
                </div>
            `;
            
            stats.style.display = 'block';
        }

        // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
        function addToHistory(testData) {
            testHistory.unshift(testData);
            
            // ìµœëŒ€ 15ê°œê¹Œì§€ë§Œ ë³´ê´€
            if (testHistory.length > 15) {
                testHistory = testHistory.slice(0, 15);
            }
            
            updateHistoryDisplay();
        }

        // íˆìŠ¤í† ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            
            if (testHistory.length === 0) {
                historyList.innerHTML = '<p style="color: #666; text-align: center;">ì•„ì§ í…ŒìŠ¤íŠ¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            historyList.innerHTML = testHistory.map((item, index) => `
                <div class="history-item" onclick="loadFromHistory(${index})">
                    <div><strong>ì¼ê¸° í…ŒìŠ¤íŠ¸</strong> - ${item.responseTime}ms</div>
                    <div style="margin: 5px 0; font-size: 13px; color: #666;">
                        ${item.diary.substring(0, 80)}${item.diary.length > 80 ? '...' : ''}
                    </div>
                    <small>${item.timestamp.toLocaleString()}</small>
                </div>
            `).join('');
        }

        // íˆìŠ¤í† ë¦¬ì—ì„œ ë¡œë“œ
        function loadFromHistory(index) {
            const item = testHistory[index];
            if (!item) return;

            document.getElementById('summaryJson').value = item.summaryJson;
            document.getElementById('diaryPlanJson').value = item.diaryPlanJson;

            // ì¶œë ¥ì—ë„ í‘œì‹œ
            const diaryOutput = document.getElementById('diaryOutput');
            diaryOutput.className = 'output-area diary-output success';
            diaryOutput.textContent = item.diary;
            currentResponse = { diary: item.diary };

            showStats(item.responseTime, { diary: item.diary });
        }

        // ì¼ê¸° í‰ê°€
        function rateDiary(rating) {
            if (!currentResponse) {
                alert('í‰ê°€í•  ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const messages = {
                excellent: 'ğŸŒŸ í›Œë¥­í•œ ì¼ê¸°ë¡œ í‰ê°€í–ˆìŠµë‹ˆë‹¤!',
                good: 'ğŸ‘ ì¢‹ì€ ì¼ê¸°ë¡œ í‰ê°€í–ˆìŠµë‹ˆë‹¤!',
                fair: 'âš–ï¸ ë³´í†µ ìˆ˜ì¤€ì˜ ì¼ê¸°ë¡œ í‰ê°€í–ˆìŠµë‹ˆë‹¤.',
                poor: 'ğŸ‘ ê°œì„ ì´ í•„ìš”í•œ ì¼ê¸°ë¡œ í‰ê°€í–ˆìŠµë‹ˆë‹¤.',
                save: 'ğŸ’¾ ì¼ê¸°ë¥¼ ì €ì¥í–ˆìŠµë‹ˆë‹¤!'
            };

            // ì—¬ê¸°ì„œ ì‹¤ì œë¡œëŠ” ì„œë²„ì— í‰ê°€ ë°ì´í„°ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŒ
            console.log(`ì¼ê¸° í‰ê°€: ${rating}`, currentResponse);
            
            alert(messages[rating]);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            console.log('ì¼ê¸° ìƒì„± í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // ê¸°ë³¸ í”„ë¦¬ì…‹ ë¡œë“œ
            loadPreset('childhood');
        };
    </script>
</body>
</html>
